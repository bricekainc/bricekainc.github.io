(()=>{function e(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),o.push.apply(o,t)}return o}function r(r){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?e(Object(s),!0).forEach(function(e){o(r,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(s,e))})}return r}function o(e,r,o){return(r=function(e){var r=function(e){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof r?r:r+""}(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}(()=>{function e(e,r){return new Promise(o=>{try{chrome.runtime.sendMessage({action:e,payload:r},e=>{var r=chrome.runtime.lastError;o(r?{__transportError:r.message}:e)})}catch(e){o({__transportError:(null==e?void 0:e.message)||String(e)})}})}function o(e){return fetch(e).then(e=>{if(!e.ok)throw new Error("Fetch failed with status ".concat(e.status));return e.arrayBuffer()})}window.addEventListener("message",t=>{var s,n;if(t.source===window){var c=t.data;if("EXT_STATE_REQUEST"===(null==c?void 0:c.type)){var{id:i,action:a,enabled:l}=c,d=e=>window.postMessage(r({type:"EXT_STATE_RESPONSE",id:i},e),"*");return"GET"===a?void chrome.runtime.sendMessage({action:"getState"},e=>{var r=chrome.runtime.lastError;d(r?{success:!1,error:r.message}:{success:!0,enabled:null==e?void 0:e.enabled})}):"SET"===a?void chrome.runtime.sendMessage({action:"toggleState",enabled:!!l},()=>{var e=chrome.runtime.lastError;d(e?{success:!1,error:e.message}:{success:!0,enabled:!!l})}):void d({success:!1,error:"Unknown action: ".concat(a)})}if(null!=c&&null!==(s=c.type)&&void 0!==s&&s.startsWith("PROGRESS_REQUEST_")){var u=c.type.replace("PROGRESS_REQUEST_",""),{id:f,data:m}=c;function v(e){window.postMessage(r({type:"PROGRESS_RESPONSE_".concat(u),id:f},e),"*")}var g={GET:"getProgress",SET:"setProgress",CLEAR:"clearProgress"}[u];if(!g)return void v({success:!1,error:"Unknown action: ".concat(u)});var E="SET"===u?{action:g,progress:null==m?void 0:m.progress}:{action:g};return void chrome.runtime.sendMessage(E,e=>{var r=chrome.runtime.lastError;v(r?{success:!1,error:r.message||"Background script error"}:"GET"===u?{success:!1!==(null==e?void 0:e.success),progress:(null==e?void 0:e.progress)||{},error:null==e?void 0:e.error}:{success:!1!==(null==e?void 0:e.success),error:null==e?void 0:e.error})})}if(c&&"BLOB_DOWNLOAD_REQUEST"===c.type){var{id:p,payload:h}=c||{},b=function(e){var o=!1;return t=>{if(!o){o=!0;try{window.postMessage(r({type:"BLOB_DOWNLOAD_RESPONSE",id:e},t),"*")}catch(r){try{window.postMessage({type:"BLOB_DOWNLOAD_RESPONSE",id:e,success:!1,code:"ERR_POSTMESSAGE",error:String((null==r?void 0:r.message)||r)},"*")}catch(e){}}}}}(p),y=setTimeout(()=>{b({success:!1,code:"ERR_CONTENT_TIMEOUT",error:"Timed out waiting for background response (25s)"})},25e3),O=e=>{clearTimeout(y),b(e)};try{var R="undefined"!=typeof browser&&void 0!==browser.runtime?"firefox":"undefined"!=typeof chrome&&void 0!==chrome.runtime?"chrome":(n=navigator.userAgent||"",/firefox/i.test(n)?"firefox":/chrome|chromium|crios/i.test(n)&&!/edge|edg|opr|opera/i.test(n)?"chrome":"unknown"),{blobUrl:_,filename:w,showFolderPicker:S}=h||{};if("string"!=typeof w||!w.trim()){var T="Invalid filename in BLOB_DOWNLOAD_REQUEST: expected non-empty string, got ".concat(typeof w).concat(w?" (length: ".concat(w.length,")"):"");return void O({success:!1,code:"ERR_INVALID_FILENAME",error:T})}if("firefox"===R)return"string"==typeof _&&_.startsWith("blob:")?void o(_).then(r=>e("downloadArrayBuffer",{buffer:r,filename:w,showFolderPicker:S})).then(e=>{e&&"boolean"==typeof e.success?O({success:e.success,code:e.code||(e.success?"OK":"ERR_BACKGROUND"),error:e.error||null,downloadId:e.downloadId}):O({success:!1,code:"ERR_NO_RESPONSE",error:(null==e?void 0:e.__transportError)||"Background returned no/invalid response"})}).catch(e=>{O({success:!1,code:"ERR_FETCH_BLOB",error:(null==e?void 0:e.message)||String(e)})}):void O({success:!1,code:"ERR_INVALID_BLOB_URL",error:"Invalid blob URL. Expected a 'blob:' URL string."});if("string"==typeof _&&_.startsWith("blob:"))return void e("downloadBlobUrl",{blobUrl:_,filename:w,showFolderPicker:S}).then(r=>{if(r&&!0===r.success)O({success:!0,code:r.code||"OK",error:null,downloadId:r.downloadId});else{var t="firefox"!==R&&function(e){var r=((null==e?void 0:e.error)||(null==e?void 0:e.__transportError)||"").toLowerCase();return/access denied/.test(r)||/type error/.test(r)||/blob:/.test(r)||/invalid url/i.test(r)||/error processing url/i.test(r)}(r);t?o(_).then(r=>e("downloadArrayBuffer",{buffer:r,filename:w,showFolderPicker:S})).then(e=>{e&&"boolean"==typeof e.success?O({success:e.success,code:e.code||(e.success?"OK":"ERR_BACKGROUND"),error:e.error||null,downloadId:e.downloadId}):O({success:!1,code:"ERR_NO_RESPONSE",error:(null==e?void 0:e.__transportError)||"Background returned no/invalid response"})}).catch(e=>{O({success:!1,code:"ERR_FETCH_BLOB",error:(null==e?void 0:e.message)||String(e)})}):O({success:!1,code:(null==r?void 0:r.code)||"ERR_BACKGROUND",error:(null==r?void 0:r.error)||(null==r?void 0:r.__transportError)||"Background returned no/invalid response"})}});O({success:!1,code:"ERR_INVALID_BLOB_URL",error:"Invalid or missing blob URL."})}catch(L){O({success:!1,code:"ERR_CONTENT_THROW",error:(null==L?void 0:L.message)||String(L)})}}}})})(),(e=>{var r=[{type:"script",src:"js/confetti.browser.min.js",isModule:!0},{type:"script",src:"js/injex.js",isModule:!0},{type:"link",href:"styles/injex.css"}],o=()=>{(function(){try{return"false"!==localStorage.getItem("tik.tok::extensionEnabled")}catch(e){return!0}})()&&r.forEach(e=>{var{type:r,href:o,src:t,isModule:s}=e;if(!document.querySelector("".concat(o?"".concat(r,'[href="').concat(chrome.runtime.getURL(o),'"]'):"").concat(o&&t?", ":"").concat(t?"".concat(r,'[src="').concat(chrome.runtime.getURL(t),'"]'):""))){var n=document.createElement(r);n.setAttribute("data-injected","true"),"link"===r?(n.rel="stylesheet",o&&(n.href=chrome.runtime.getURL(o))):"script"===r&&t&&(n.src=chrome.runtime.getURL(t),n.type=s?"module":"text/javascript"),(document.head||document.documentElement).appendChild(n)}})};if(o(),new MutationObserver(e=>{for(var r of e)if(Array.from(r.addedNodes).some(e=>1===e.nodeType&&"HEAD"===e.tagName)){o();break}}).observe(document.documentElement,{childList:!0,subtree:!0}),"undefined"!=typeof chrome&&null!==(e=chrome.runtime)&&void 0!==e&&e.sendMessage){var t,s="tik.tok::extensionEnabled",n=(()=>{try{var e=localStorage.getItem(s);return null===e||"false"!==e}catch(e){return!0}})(),c=e=>{var r=n;n=e;try{localStorage.setItem(s,e?"true":"false")}catch(e){}if(!1===r&&!0===e)try{setTimeout(()=>{window.location.reload()},200)}catch(e){}};null!==(t=chrome.runtime)&&void 0!==t&&t.onMessage&&chrome.runtime.onMessage.addListener((e,r,o)=>{if("stateBroadcast"===(null==e?void 0:e.action)&&void 0!==e.enabled){var t=!!e.enabled;if(c(t),o)try{o({success:!0})}catch(e){}return!0}if("resumeDownload"===(null==e?void 0:e.action)){var{payload:s}=e,{username:n,tabName:i,isCollection:a,collectionUrl:l}=s||{};if(window.postMessage({type:"RESUME_DOWNLOAD",payload:{username:n,tabName:i,isCollection:a,collectionUrl:l}},"*"),o)try{o({success:!0})}catch(e){}return!0}}),chrome.storage&&chrome.storage.onChanged&&chrome.storage.onChanged.addListener((e,r)=>{if("local"===r&&e[s]){var o=e[s].newValue;c(!("false"===o||!1===o))}}),new Promise(e=>{chrome.runtime.sendMessage({action:"getState"},r=>{if(chrome.runtime.lastError)e();else{if(r&&void 0!==r.enabled){var o=!!r.enabled;n=o;try{localStorage.setItem(s,r.enabled?"true":"false")}catch(e){}}e()}})})}})()})();