(()=>{var e;function r(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function t(e,r,t){return(r=function(e){var r=function(e){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof r?r:r+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function n(e,r,t,n,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void t(e)}c.done?r(l):Promise.resolve(l).then(n,o)}function o(e){return function(){var r=this,t=arguments;return new Promise(function(o,a){var i=e.apply(r,t);function c(e){n(i,o,a,c,l,"next",e)}function l(e){n(i,o,a,c,l,"throw",e)}c(void 0)})}}var a=(null===globalThis||void 0===globalThis?void 0:globalThis.AppStateETTVD)||{debug:{active:!1}};globalThis&&(globalThis.AppStateETTVD=a);var i=()=>{var e;return!(null==a||null===(e=a.debug)||void 0===e||!e.active)},c="tik.tok::extensionEnabled",l="tik.tok::downloadProgress";function s(e,n){return function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach(function(r){t(e,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))})}return e}({success:!1,code:e,error:n,message:n},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}chrome.runtime.onInstalled.addListener(o(function*(){try{null==(yield h(c))&&(yield w(c,"true"),i())}catch(e){}})),chrome.runtime.onMessage.addListener((e,r,t)=>{var n=null==e?void 0:e.action,a=function(e){var r=!1;return t=>{if(!r){r=!0;try{e(t)}catch(e){}}}}(t),u=null;function d(e){u&&clearTimeout(u),a(e)}i();var f=!0;if("getState"===n)return o(function*(){try{var e=yield h(c),r=!("false"===e||!1===e);i(),d({enabled:r})}catch(e){d({enabled:!0})}})(),f;if("toggleState"===n){var v=!(null==e||!e.enabled);return o(function*(){try{yield w(c,v?"true":"false");try{chrome.storage&&chrome.storage.local&&chrome.storage.local.set({[c]:v?"true":"false"},()=>{var e;null!==(e=chrome.runtime)&&void 0!==e&&e.lastError&&i()})}catch(e){i()}i();var e={action:"stateBroadcast",enabled:v};try{chrome.runtime.sendMessage(e,()=>{chrome.runtime.lastError&&i()})}catch(e){i()}d({success:!0,enabled:v})}catch(e){d({success:!1,error:String(e)})}})(),f}if("getProgress"===n)return o(function*(){try{var e=(yield h(l))||{};i(),d({success:!0,progress:e})}catch(e){d({success:!1,error:String(e)})}})(),f;if("setProgress"===n)return o(function*(){try{var r=(null==e?void 0:e.progress)||{};yield w(l,r),i(),d({success:!0})}catch(e){d({success:!1,error:String(e)})}})(),f;if("clearProgress"===n)return o(function*(){try{yield w(l,{}),i(),d({success:!0})}catch(e){d({success:!1,error:String(e)})}})(),f;if("getCollectionUrl"===n)return o(function*(){try{var r,{username:t,tabName:n}=e||{};if(!t||!n)return void d({success:!1,error:"Missing username or tabName"});var o=(yield h(l))||{},a=t.toLowerCase().trim(),c="_".concat(n,"_url"),s=(null===(r=o[a])||void 0===r||null===(r=r._metadata)||void 0===r?void 0:r[c])||null;i(),d({success:!0,collectionUrl:s})}catch(e){d({success:!1,error:String(e)})}})(),f;if("downloadArrayBuffer"===n){try{var y,m=null!==(y=null==e?void 0:e.payload)&&void 0!==y?y:{},{buffer:p,filename:g,showFolderPicker:b}=m;if(!(p instanceof ArrayBuffer||(null==p?void 0:p.buffer)instanceof ArrayBuffer))return d(s("ERR_INVALID_BUFFER","payload.buffer must be an ArrayBuffer"));if("string"!=typeof g||!g.trim())return d(s("ERR_INVALID_FILENAME","Invalid filename in downloadArrayBuffer: expected non-empty string, got ".concat(typeof g).concat(g?" (length: ".concat(g.length,', contains: "').concat(String(g).slice(0,50),'")'):"")));if(null!=b&&"boolean"!=typeof b)return d(s("ERR_INVALID_SAVEAS_FLAG","showFolderPicker must be a boolean when provided."));var _=new Blob([p instanceof ArrayBuffer?p:p.buffer]),R=URL.createObjectURL(_);u=setTimeout(()=>{try{URL.revokeObjectURL(R)}catch(e){}d(s("ERR_DOWNLOAD_TIMEOUT","Timed out waiting for chrome.downloads.download callback (20s)."))},2e4),i(),chrome.downloads.download({url:R,filename:g,saveAs:void 0===b||!!b},e=>{var r=chrome.runtime.lastError;if(r){try{URL.revokeObjectURL(R)}catch(e){}return d(s("ERR_CHROME_DOWNLOADS","Chrome downloads API error: ".concat(r.message||"Download failed").concat(g?' (filename: "'.concat(g.slice(0,100),'")'):"")))}if("number"!=typeof e){try{URL.revokeObjectURL(R)}catch(e){}return d(s("ERR_NO_DOWNLOAD_ID","chrome.downloads.download did not return a downloadId."))}setTimeout(()=>{try{URL.revokeObjectURL(R)}catch(e){i()}},5e3),d({success:!0,downloadId:e})})}catch(e){d(s("ERR_HANDLER_THROW",(null==e?void 0:e.message)||String(e)))}return f}if("downloadBlobUrl"===n){try{var O,L=null!==(O=null==e?void 0:e.payload)&&void 0!==O?O:{},{blobUrl:S,filename:A,showFolderPicker:E}=L;if("string"!=typeof S||!S.startsWith("blob:"))return d(s("ERR_INVALID_BLOB_URL","Invalid blob URL. Expected a 'blob:' URL string.",{received:"string"==typeof S?S.slice(0,64):typeof S}));if("string"!=typeof A||!A.trim())return d(s("ERR_INVALID_FILENAME","Invalid filename in downloadBlobUrl: expected non-empty string, got ".concat(typeof A).concat(A?" (length: ".concat(A.length,', contains: "').concat(String(A).slice(0,50),'")'):"")));if(null!=E&&"boolean"!=typeof E)return d(s("ERR_INVALID_SAVEAS_FLAG","showFolderPicker must be a boolean when provided."));u=setTimeout(()=>{d(s("ERR_DOWNLOAD_TIMEOUT","Timed out waiting for chrome.downloads.download callback (20s)."))},2e4),i(),chrome.downloads.download({url:S,filename:A,saveAs:void 0===E||!!E},e=>{var r=chrome.runtime.lastError;return i(),r?d(s("ERR_CHROME_DOWNLOADS","Chrome downloads API error: ".concat(r.message||"Download failed").concat(A?' (filename: "'.concat(A.slice(0,100),'")'):""))):"number"!=typeof e?d(s("ERR_NO_DOWNLOAD_ID","chrome.downloads.download did not return a downloadId.")):void d({success:!0,downloadId:e})})}catch(e){d(s("ERR_HANDLER_THROW",(null==e?void 0:e.message)||String(e),{stack:null==e?void 0:e.stack}))}return f}return!1}),i();var u={ID:"1FAIpQLSffgRV8RnpECLl-S2GiS-ChMvlO-KKWzIrP9fF6TipKcGtNfQ",entries:{reason:"entry.639071765",comments:"entry.1143690280",nps:"entry.2017892424",extension_version:"entry.237420762",installed_at:"entry.1114905105",days_used:"entry.736618219",platform:"entry.1118263614",ui_language:"entry.499043465",anon_id:"entry.1638558729"}},d="tik.tok::installedAt",f="tik.tok::anonId";function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"uninstall-meta";return new Promise((r,t)=>{var n=indexedDB.open(e,1);n.onupgradeneeded=()=>{var e=n.result;e.objectStoreNames.contains("kv")||e.createObjectStore("kv")},n.onsuccess=()=>r(n.result),n.onerror=()=>t(n.error)})}function y(e){return m.apply(this,arguments)}function m(){return(m=o(function*(e){var r=yield v("uninstall-meta");return new Promise((t,n)=>{var o=r.transaction("kv","readonly").objectStore("kv").get(e);o.onsuccess=()=>t(o.result),o.onerror=()=>n(o.error)})})).apply(this,arguments)}function p(e,r){return g.apply(this,arguments)}function g(){return(g=o(function*(e,r){var t=yield v("uninstall-meta");return new Promise((n,o)=>{var a=t.transaction("kv","readwrite").objectStore("kv").put(r,e);a.onsuccess=()=>n(),a.onerror=()=>o(a.error)})})).apply(this,arguments)}function h(e){return b.apply(this,arguments)}function b(){return(b=o(function*(e){var r=yield v("ettvd-data");return new Promise((t,n)=>{var o=r.transaction("kv","readonly").objectStore("kv").get(e);o.onsuccess=()=>t(o.result),o.onerror=()=>n(o.error)})})).apply(this,arguments)}function w(e,r){return _.apply(this,arguments)}function _(){return(_=o(function*(e,r){var t=yield v("ettvd-data");return new Promise((n,o)=>{var a=t.transaction("kv","readwrite").objectStore("kv").put(r,e);a.onsuccess=()=>n(),a.onerror=()=>o(a.error)})})).apply(this,arguments)}function R(){return O.apply(this,arguments)}function O(){return(O=o(function*(){var e,r=yield y(d),t=yield y(f);return r||(r=Date.now(),yield p(d,r)),t||(e=new Uint8Array(16),crypto.getRandomValues(e),t=[...e].map(e=>e.toString(16).padStart(2,"0")).join(""),yield p(f,t)),{installedAt:r,anonId:t}})).apply(this,arguments)}function L(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();return Math.max(0,Math.floor((r-e)/864e5))}function S(){return A.apply(this,arguments)}function A(){return(A=o(function*(){var e,r,t,n,{installedAt:o,anonId:a}=yield R(),i=chrome.runtime.getManifest().version,c=chrome.i18n.getUILanguage(),l=yield chrome.runtime.getPlatformInfo(),s="".concat(l.os,"/").concat(l.arch),d=(e={extension_version:i,installed_at:new Date(o).toISOString(),days_used:L(o),ui_language:c,platform:s,anon_id:a},r="https://docs.google.com/forms/d/e/".concat(u.ID,"/viewform?usp=pp_url"),t=new URLSearchParams,(n=(e,r)=>null!=r&&t.set(u.entries[e],String(r)))("extension_version",e.extension_version),n("installed_at",e.installed_at),n("days_used",e.days_used),n("ui_language",e.ui_language),n("platform",e.platform),n("anon_id",e.anon_id),"".concat(r,"&").concat(t.toString()));chrome.runtime.setUninstallURL(d)})).apply(this,arguments)}chrome.runtime.onInstalled.addListener(o(function*(){yield R()})),null===(e=chrome.runtime.onStartup)||void 0===e||e.addListener(()=>{S().catch(e=>{})}),S().catch(e=>{})})();